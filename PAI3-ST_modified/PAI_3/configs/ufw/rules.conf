# UFW Firewall Rules
# PAI-3 VULNAWEB - Security Team INSEGUS
# Configuración para servidor de comercio electrónico

# =============================================================================
# POLÍTICAS POR DEFECTO
# =============================================================================
# Denegar todo el tráfico entrante por defecto
# Permitir todo el tráfico saliente por defecto

ufw default deny incoming
ufw default allow outgoing

# =============================================================================
# REGLAS DE ENTRADA (SERVICIOS PÚBLICOS)
# =============================================================================

# HTTP - Puerto 80
# Necesario para redireccionamiento a HTTPS
ufw allow 80/tcp comment 'HTTP - Redirect to HTTPS'

# HTTPS - Puerto 443
# Principal puerto para comercio electrónico
ufw allow 443/tcp comment 'HTTPS - E-commerce'

# SSH - Puerto 22
# Para administración remota
# NOTA: Considerar cambiar a puerto no estándar
# NOTA: Considerar limitar a IPs específicas
ufw allow 22/tcp comment 'SSH - Admin access'
# Alternativa con IP específica:
# ufw allow from 192.168.1.100 to any port 22 proto tcp comment 'SSH from admin IP only'

# =============================================================================
# REGLAS DE ENTRADA (SERVICIOS INTERNOS - Opcional)
# =============================================================================

# MySQL - Solo desde localhost o IPs específicas
# ufw allow from 192.168.1.0/24 to any port 3306 proto tcp comment 'MySQL from internal network'

# PostgreSQL
# ufw allow from 192.168.1.0/24 to any port 5432 proto tcp comment 'PostgreSQL from internal network'

# =============================================================================
# LIMITACIÓN DE TASA (Rate Limiting)
# =============================================================================

# Limitar intentos de conexión SSH para prevenir fuerza bruta
# Permite 6 conexiones en 30 segundos
ufw limit 22/tcp comment 'SSH rate limiting'

# =============================================================================
# REGLAS ESPECÍFICAS POR IP
# =============================================================================

# Permitir desde IPs de oficina
# ufw allow from 203.0.113.10 comment 'Office IP'
# ufw allow from 203.0.113.11 comment 'Office IP 2'

# Bloquear IPs maliciosas conocidas
# ufw deny from 198.51.100.10 comment 'Blocked IP - Attack attempts'

# =============================================================================
# REGLAS AVANZADAS
# =============================================================================

# Permitir ping (ICMP)
# ufw allow proto icmp comment 'ICMP - Ping'

# Permitir NTP (sincronización de tiempo)
# ufw allow out 123/udp comment 'NTP client'

# Permitir DNS (consultas salientes)
# Por defecto está permitido (outgoing allow)
# ufw allow out 53 comment 'DNS queries'

# =============================================================================
# LOGGING
# =============================================================================

# Habilitar logging
# Niveles: off, low, medium, high, full
ufw logging medium

# =============================================================================
# IPV6
# =============================================================================

# Si no se usa IPv6, deshabilitarlo en /etc/default/ufw
# IPV6=no

# Si se usa IPv6, aplicar reglas similares:
# ufw allow 80/tcp
# ufw allow 443/tcp
# ufw allow 22/tcp

# =============================================================================
# ESTADO Y VERIFICACIÓN
# =============================================================================

# Ver estado
# ufw status verbose
# ufw status numbered

# Ver reglas específicas
# ufw show listening
# ufw show added

# =============================================================================
# NOTAS IMPORTANTES
# =============================================================================

# 1. Verificar que fail2ban está instalado y configurado
#    para protección adicional contra ataques de fuerza bruta

# 2. Considerar implementar geoblocking si el e-commerce
#    solo opera en ciertos países

# 3. Monitorear logs regularmente:
#    tail -f /var/log/ufw.log

# 4. Revisar y actualizar reglas periódicamente

# 5. Documentar todos los cambios

# =============================================================================
# COMANDOS ÚTILES
# =============================================================================

# Habilitar firewall
# ufw enable

# Deshabilitar firewall (solo para debugging)
# ufw disable

# Recargar reglas
# ufw reload

# Resetear configuración (cuidado!)
# ufw reset

# Eliminar regla por número
# ufw delete 3

# Insertar regla en posición específica
# ufw insert 1 allow from 192.168.1.100

# =============================================================================
# ARCHIVO DE CONFIGURACIÓN
# =============================================================================

# Este archivo es solo documentación.
# Las reglas reales se aplican con los comandos ufw mostrados arriba
# o se configuran en:
# /etc/ufw/user.rules (IPv4)
# /etc/ufw/user6.rules (IPv6)
# /etc/ufw/before.rules (reglas aplicadas antes)
# /etc/ufw/after.rules (reglas aplicadas después)

# =============================================================================
# END OF UFW CONFIGURATION
# =============================================================================
